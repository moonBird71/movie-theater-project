
{% extends 'base.html' %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
    <script src="//unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
    <script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
    <script type='text/javascript'>
        //this is fine even though it complains. IDE doesn't understand js/Django/Vue combo
        var seatsBoughtJ = {{ seatsBought|safe }};
        var seatsPickedJ = {{seatsPicked|safe}};
        var rowsJ = {{numberRows}};
        var colsJ = {{numberCols}};
        var title = "{{showing.movie.movietitle}}";
        var mTime = "{{showing.time}}";
        var showingId = {{showing.id}}
    </script>
    <div id="vapp">
    {% endblock %}
    {% block styles %}
      <meta charset='utf-8' />
      <link
      type="text/css"
      rel="stylesheet"
      href="//unpkg.com/bootstrap/dist/css/bootstrap.min.css"
    />
    <link
      type="text/css"
      rel="stylesheet"
      href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"
    /> 
    <!--<link type="text/css" rel="stylesheet" href="/static/css/table.css"></style>-->
    {% endblock %}
    
    <body>
        {% block content %}
        {% if showing %}
      <h1>Seat Preview and Selection</h1>
      <h3>Seats for [[movieTitle]]</h3>
      <h3>Guide:</h3>
    <!-- guide box -->
    <ul style="width:600px;" class="flex-container">
        Available:
        <li style="background:#0544f0;" class="flex-item">1,1</li>
        Selected:
        <li style="background:#00f133;" class="flex-item">1,1</li>
        Unavailable:
        <li style="background:#666666;" class="flex-item">1,1</li>
        <h3>Pricing:</h3>
        <table>
            {% for price in pGroup %}
            <tr><td>{{price.name }}:</td><td>${{ price.price }}</td></tr>
            {% endfor %}
        </table>
    </ul>
      <div class="grid">
        <h3>[SCREEN]</h3>
          <table class="flex-container">
            <tr>
                <template v-for="i in numberCols">
                    <td>
                        <template v-for="j in numberRows">
                            <table v-on:click="seatClick(i,j)" class='itemj-i flex-item' :bgcolor="[[picked[ j ][ i ] ]]">
                                
                            </table>
                        </template>
                    </td>
                </template>
            </tr>
        </table>
    </div>
            <template v-if="numberTickets>0">
                <form ref="buyForm" action="{% url 'ticketingApps:ticket-type' %}" method="get">
                    {% csrf_token %}
                    <input type="hidden" name="toBuy" id="toBuy" :value="JSON.stringify(toBuy)">
                    <input type="hidden" name="showingId" id="showingId" :value="showing">
                    <button type="submit">Buy Tickets</button>
                </form>
            </template>
            <br>
            {% endif %}
            
        </div>
        {% endblock %}
    <!-- Our View App goes at the end of the document -->
    
    {% block endscripts %}
    <script>
    
    var vapp=new Vue({
            el: '#vapp',
            delimiters: ['[[', ']]'],
            data: { 
                movieTitle: title,
                time: mTime,
                numberRows: rowsJ,
                numberCols: colsJ,
                seatsBought: seatsBoughtJ,
                picked: seatsPickedJ,
                toBuy: {},
                showing: showingId,
                numberTickets: 0
            },
            methods: {
                seatClick(i,j){
                    if(this.picked[String(j)][String(i)]=="#666666"){
                        //this seat is already bought
                    }else if(this.picked[j][i]=="#0544F0"){
                        this.picked[j][i]="#00F133"
                        this.toBuy[j*this.numberCols+i]=[j,i]
                        this.numberTickets++
                    }else{
                        this.picked[j][i]="#0544F0"
                        delete this.toBuy[j*this.numberCols+i]
                        this.numberTickets--
                    }
                },
                //submitForm(){
                  //  this.$refs.buyForm.$el.submit()
                //}
            }
        });
    </script>
    {% endblock %}
    </body>

